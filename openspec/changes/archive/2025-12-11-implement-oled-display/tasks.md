# Tasks: OLED 显示驱动实装

## 1. 环境准备

- [x] 1.1 添加 u8g2 组件依赖（使用 Git 子模块）
- [x] 1.2 更新 `main/CMakeLists.txt` 添加 u8g2 相关源文件

## 2. API 变更（移除天气参数）

- [x] 2.1 更新 `main/ui/oled_display.h` 移除 `WeatherData *weather` 参数
- [x] 2.2 更新 `main/ui/oled_display.c` 函数签名
- [x] 2.3 更新 `main/main.c` 调用点移除 NULL 参数

## 3. HAL 适配层实现

- [x] 3.1 创建 `main/ui/u8g2_esp32_hal.h` 头文件
- [x] 3.2 实现 `u8g2_esp32_i2c_byte_cb()` I2C 字节传输回调
- [x] 3.3 实现 `u8g2_esp32_gpio_and_delay_cb()` GPIO 和延时回调
- [x] 3.4 实现 `u8g2_esp32_hal_init()` HAL 初始化函数

## 4. 核心显示功能实现

- [x] 4.1 实现 `oled_display_init()` - u8g2 初始化、字体设置
- [x] 4.2 定义历史数据环形缓冲区结构（60 点容量）
- [x] 4.3 实现 `oled_add_history_point()` - 添加历史数据点

## 5. 主页面渲染（无天气行）

- [x] 5.1 实现 CO2 数值显示（大字号 + 状态标签）
- [x] 5.2 实现模式徽章显示（右上角 [REMOTE]/[LOCAL]）
- [x] 5.3 实现温湿度显示行
- [x] 5.4 实现趋势图绘制函数（扩展区域）
- [x] 5.5 实现趋势图基准线（1000ppm）和告警线（1500ppm）
- [x] 5.6 实现风扇状态 + WiFi 状态合并栏
- [x] 5.7 整合 `oled_display_main_page()` 完整渲染流程

## 6. 告警页面实现

- [x] 6.1 实现告警页面布局绘制
- [x] 6.2 实现 1Hz 闪烁效果（软件定时器）
- [x] 6.3 实现 3 秒自动返回机制
- [x] 6.4 整合 `oled_display_alert()` 完整流程

## 7. 验证与测试

- [x] 7.1 编译验证，确保无编译错误 ✅
- [ ] 7.2 验证 I2C 通信正常（与 SHT35 共存）- 需要硬件测试
- [ ] 7.3 验证主页面各元素显示正确 - 需要硬件测试
- [ ] 7.4 验证告警页面闪烁和自动返回 - 需要硬件测试
- [ ] 7.5 验证趋势图数据更新和基准线显示 - 需要硬件测试

## Dependencies

- 任务 2 可独立执行（API 变更）
- 任务 3 依赖任务 1 完成
- 任务 4-6 依赖任务 3 完成
- 任务 5.4/5.5 依赖任务 4.2/4.3 完成
- 任务 7 依赖任务 4-6 全部完成

## Parallelizable Work

- 任务 2 和任务 1 可并行
- 任务 5.1-5.3, 5.6 可并行开发（独立的 UI 组件）
- 任务 6.1-6.3 可并行开发

## 实施总结

所有代码实现已完成并通过编译验证。硬件测试（7.2-7.5）需要实际 ESP32-S3 设备和 OLED 显示屏。
